<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculator</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="case">
        <div class="screen"></div>
            <div class="button-container">
                <button class="clear">CLEAR</button>
                <button class="del">DELETE</button>
                <button id="num" data-key="7">7</button>
                <button id="num" data-key="8">8</button>
                <button id="num" data-key="9">9</button>
                <button id="op" data-key="/">\</button>
                <button id="num" data-key="4">4</button>
                <button id="num" data-key="5">5</button>
                <button id="num" data-key="6">6</button>
                <button id="op" data-key="*">*</button>
                <button id="num" data-key="1">1</button>
                <button id="num" data-key="2">2</button>
                <button id="num" data-key="3">3</button>
                <button id="op" data-key="-">-</button>
                <button id="op" data-key=".">.</button>
                <button id="num" data-key="0">0</button>
                <button id="op" data-key="=">=</button>
                <button id="op" data-key="+">+</button>
        </div>
    </div>
    <script>

    let fullNum = []; //This array should never exceed two items
    let partNum = [];
    let currentOperator;
    let lastOperator;
    let equalsPressed = false;
    let operatorActive = false;
        
        //screen
        const screen = document.querySelector('.screen');
        //clear and del button events
        const clearBtn = document.querySelector('.clear'); //An alternative to this method is to have partNum arrays push into a seperate inputHistory array. 
              clearBtn.addEventListener('click', clearUsed);

        const delBtn = document.querySelector('.del');
              delBtn.addEventListener('click', () => {
                fullNum = [];
                partNum = [];
                equalsPressed = false;
                operatorActive = false;
                screen.textContent = '';
              });
        
        //numbers and number events
        const numButtons = document.querySelectorAll('#num'); 
              numButtons.forEach(a => a.addEventListener('click', () => {screen.textContent += a.dataset.key; partNum.push(a.dataset.key)}));
    
        function handleKeys (e){
            let onlyNums = ['0','1','2','3','4','5','6','7','8','9'];
            let operators = ['+','-','*','/'];
            if(e.key == 'Backspace') clearUsed();
            if(operators.includes(e.key)) operatorUsed(e.key);
            if(e.key == 'Enter' & !equalsPressed) equalsUsed();
            if(e.key == '.') decimalUsed();
            if(!onlyNums.includes(e.key)) return;
            screen.textContent += e.key; partNum.push(e.key);
        }
        window.addEventListener('keydown', handleKeys);

        //operators and operator events
        const operatorButtons = document.querySelectorAll('#op'); 
              operatorButtons.forEach(a => a.addEventListener('click', () => {
                    if(a.dataset.key != '=' && a.dataset.key != '.') operatorUsed(a.dataset.key);
                    else if (a.dataset.key == '=' && !equalsPressed) equalsUsed();
                    else if (a.dataset.key == '.') decimalUsed();
              }));

    function operatorUsed(op){
        equalsPressed = false;
        currentOperator = op;
        createEquation();
        operatorActive = true;
    }
    function equalsUsed(){
        equalsPressed = true;
        createEquation();
    }
    function decimalUsed(){
        if(!partNum.includes('.') && partNum[0] != undefined){
            partNum.push('.'); screen.textContent += '.';}
    }
    function clearUsed(){
        if(screen.textContent == '') return;
                let tempArr = screen.textContent.split(''); // save content
                tempArr.pop();
                if(tempArr[0] == '=') tempArr.shift(); // allows for erasing of single digits from answer already given, and can be used for next equation
                screen.textContent = tempArr.join('');
                fullNum = [];
                partNum = [];
                let saveIndex;
                for (let i = 0; i < screen.textContent.length; i++){ // recreate equation based on text on screen
                    if(screen.textContent[i] == '+' || screen.textContent[i] == '-' || screen.textContent[i] == '/'  ||screen.textContent[i] == '*'){
                        currentOperator = screen.textContent[i];
                        saveIndex = i;
                    }
                }
                if(saveIndex != undefined){
                    for (let i = 0; i < screen.textContent.length; i++){ if(i < saveIndex) partNum.push(tempArr[i]);}
                    fullNum.push(partNum.join(''));
                    partNum = [];
                    for (let i = 0; i < screen.textContent.length; i++){ if(i > saveIndex) partNum.push(tempArr[i]);}
                    fullNum.push(partNum.join(''));
                    partNum = [];
                }else if(saveIndex == undefined){
                    fullNum.push(screen.textContent);
                    operatorActive = false;
                }
                if(fullNum[1] == '') fullNum.pop(); //Since the numbers get turned into strings when pushed into array, when emptied they are equal to "" instead of undefined.    
                if(fullNum[0] == '') fullNum.shift(); //these two lines are an easy bandade fix to this problem
                console.log(fullNum);
    }
    function createEquation(){ //Input limitation is based on whether partNum and fullNum arrays are undefined.
        if(currentOperator == undefined) return;
        if(partNum[0] !== undefined)fullNum.push(partNum.join(''));
        if(fullNum[0] !== undefined && !operatorActive){
            screen.textContent += currentOperator;
            lastOperator = currentOperator;
        }
        partNum = []; //important that partNum is emptied

        if(fullNum[1] !== undefined){
            let answer = operate(lastOperator, fullNum[0], fullNum[1]);
            fullNum = [];
            fullNum.push(answer);
            if(equalsPressed){
                screen.textContent = '=' + Number(answer.toFixed(4));
                lastOperator = [];
                equalsPressed = false;
            }else if (!equalsPressed){
                screen.textContent = '=' + Number(answer.toFixed(4)) + currentOperator;
                lastOperator = currentOperator;
            }
            operatorActive = false;
        }
        else return;
    }

    function operate(operator, num1, num2){
        if(fullNum[1] == undefined) return;
             if(operator == '+'){return +num1 + +num2}
        else if(operator == '-'){return +num1 - +num2}
        else if(operator == '*'){return +num1 * +num2}
        else if(operator == '/'){return +num1 / +num2}
    }
    </script>

</body>
</html>